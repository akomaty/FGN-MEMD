%% This code plots the 2D correlogram of two Fractional Gaussian processes in
%% the case of MEMD

close all
clear all
clc

for i=1:length(NDel)
    close all
    for j=1:length(H)
        RHO_all = [];
        load(['/idiap/user/akomaty/mfGn_results/IMFs_4D_MEMD_NDel_' num2str(int8(10*NDel(i))) '_H_' num2str(int8(10*H(j))) '.mat'])
        for k = 1:5000
            RHO = []; % stores the correlation of each imf index
            imf = all_imfs(:,:,:,k);
            for n = 1:size(imf,2) % n is the imf index
            imf_n = squeeze(imf(:,n,:)); % we are choosing all channels corresponding to the n^{th} imf
            imf_n = imf_n';
            RHO = cat(3,corr(imf_n));
            end
            RHO_all = cat(4,RHO); % stores every correlation matrix
            % The size of RHO_all will be p x p x n x m, in our special
            % case, it will be 8 x 8 x 8 x 5000
            % p is the number of channels
            % n is the number of imfs (imf index)
            % m is the number of MC simulations
        end
    end
end

outputFolder = '/idiap/user/akomaty/mfGn_results/'; % save data in the current directory
outputFilename = sprintf('%s/SPEC_4D_MEMD_NDel_%d_H_%d.mat', outputFolder, int8(NDel(i)*10), int8(H(j)*10));
save(outputFilename, 'mean_spec', '-v7.3') % save the spectrum


for H = 0.1:0.1:0.9
    RHO_all = [];
    for k = 1:1000
    imf_x = reshape(imf(1,:,:),size(imf,2),length(inp)); % imfs corresponding to 1st component
    imf_y = reshape(imf(2,:,:),size(imf,2),length(inp)); % imfs corresponding to 2nd component

    RHO = [];
    cc=[];
    p=2;
    for i = 1:8
        for j = 1:8
            normIMF1 = imf_x(i,:)./max(abs(imf_x(i,:)));
            normIMF2 = imf_y(j,:)./max(abs(imf_y(j,:)));
            c = corrcoef(normIMF1',normIMF2');
            RHO = [ RHO c(1,2)]; % Correlation coefficient
        end
    end
    RHO = reshape(RHO,8,8)';
    % cc = reshape(cc,size(imf,1)-1,size(imf,1)-1)';
    % plotIO(RHO,cc)
    RHO_all = cat(3,RHO_all,RHO);
    end
end

figure,
colormap('summer');   % set colormap
imagesc(abs(mean(abs(RHO_all),3)));        % draw image and scale colormap to values range
colorbar;          % show color scale
hx = xlabel('IMF index');
hy = ylabel('IMF index');
set(hx, 'FontSize', 20) 
set(hy, 'FontSize', 20) 
set(gca,'fontsize',20)


% cgo2 = HeatMap(cc);
% set(cgo2,'Colormap',redbluecmap);
% cgo3 = HeatMap(mio);
% set(cgo3,'Colormap',redbluecmap);